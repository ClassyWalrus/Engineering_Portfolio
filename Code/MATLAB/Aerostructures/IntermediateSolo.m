MatsSets(13).E = 200e9;
MatsSets(13).A = .002619467;
MatsSets(13).rho = 7860;

H = 18;
L = 3;
W = 3;

PD.N = 44;
PD.NodePos = [0,     L/2,   H;
              0,    -L/2,   H;

              (L/2)-.9,   0,   17.8; %Layer 7
              (L/2-.3)-.9,   L/2,   17.8;
              -(L/2-.3)+.9,   L/2,   17.8;
              -(L/2)+.9,   0,   17.8;
              -(L/2-.3)+.9,   -L/2,   17.8;
              (L/2-.3)-.9,   -L/2,   17.8;

              (L/2)-.8,   0,     15; %Layer 6
              (L/2-.3)-.8,   L/2,     15;
              -(L/2-.3)+.8,   L/2,     15;
              -(L/2)+.8,   0,     15;
              -(L/2-.3)+.8,   -L/2,     15;
              (L/2-.3)-.8,   -L/2,     15;

              (L/2)-.6,   0,     12; %Layer 5
              (L/2-.3)-.6,   L/2,     12;
              -(L/2-.3)+.6,   L/2,     12;
              -(L/2)+.6,   0,     12;
              -(L/2-.3)+.6,   -L/2,     12;
              (L/2-.3)-.6,   -L/2,     12;

              (L/2)-.5,   0,      9; %Layer 4
              (L/2-.3)-.5,   L/2,      9;
              -(L/2-.3)+.5,   L/2,      9;
              -(L/2)+.5,   0,      9;
              -(L/2-.3)+.5,   -L/2,      9;
              (L/2-.3)-.5,   -L/2,      9;

              (L/2)-.3,   0,      6; %Layer 3
              (L/2-.3)-.3,   L/2,      6;
              -(L/2-.3)+.3,   L/2,      6;
              -(L/2)+.3,   0,      6;
              -(L/2-.3)+.3,   -L/2,      6;
              (L/2-.3)-.3,   -L/2,      6;

              (L/2)-.2,   0,      3; %Layer 2
              (L/2-.3)-.2,   L/2,      3;
               -(L/2-.3)+.2,   L/2,      3;
              -(L/2)+.2,   0,      3;
              -(L/2-.3)+.2,   -L/2,      3;
              (L/2-.3)-.2,   -L/2,      3;

              (L/2),   0,      0; %Layer 1
              (L/2-.3),   L/2,      0;
              -(L/2-.3),   L/2,      0;
               -(L/2),   0,      0;
               -(L/2-.3),   -L/2,      0;
               (L/2-.3),   -L/2,      0;
                            ];
PD.NE = 122; %96
PD.ElmConnect = [1, 2;
                 1, 3;
                 1, 4;
                 1, 5;
                 1, 6;
                 2, 3;
                 2, 6;
                 2, 7;
                 2, 8;
                 3, 4;
                 3, 8;
                 3, 9;
                 4, 5;
                 4, 10;
                 5, 6;
                 5, 11;
                 6, 7;
                 6, 12;
                 7, 8;
                 7, 13;
                 8, 14;
                 9, 10;
                 9, 14;
                 9, 15;
                 10, 11;
                 10, 16;
                 11, 12;
                 11, 17;
                 12, 13;
                 12, 18;
                 13, 14;
                 13, 19;
                 14, 20;
                 15, 16;
                 15, 20;
                 15, 21;
                 16, 17;
                 16, 22;
                 17, 18;
                 17, 23;
                 18, 19;
                 18, 24;
                 19, 20;
                 19, 25;
                 20, 26;
                 21, 22;
                 21, 26;
                 21, 27;
                 22, 23;
                 22, 28;
                 23, 24;
                 23, 29;
                 24, 25;
                 24, 30;
                 25, 26;
                 25, 31;
                 26, 32;
                 27, 28;
                 27, 32;
                 27, 33;
                 28, 29;
                 28, 34;
                 29, 30;
                 29, 35;
                 30, 31;
                 30, 36;
                 31, 32;
                 31, 37;
                 32, 38;
                 33, 34;
                 33, 38;
                 33, 39;
                 34, 35;
                 34, 40;
                 35, 36;
                 35, 41;
                 36, 37;
                 36, 42;
                 37, 38;
                 37, 43;
                 38, 44;
                 39, 40;
                 40, 41;
                 41, 42;
                 42, 43;
                 43, 44;
                 44, 39;
%Cross bars down node 1 and 2 sides
                 4, 11;
                 7, 14;
                 11, 16;
                 14, 19;
                 19, 26;
                 16, 23;
                 23, 28;
                 26, 31;
                 31, 44;
                 28, 35;
                 35, 40;
%Cross bars on all other sides
                 3, 10;
                 10, 15;
                 15, 22;
                 22, 27;
                 27, 34;
                 34,39;

                 3, 14;
                 14, 15;
                 15, 26;
                 26, 27;
                 27, 38;
                 38, 39;

                 6, 11;
                 6, 13;
                 11, 18;
                 18, 23;
                 23, 30;
                 30, 35;
                 35, 42;
                 13, 18;
                 18, 25;
                 25, 30;
                 30, 37;
                 37, 42;

                    ];
PD.NM = 13;
PD.MatsSets = MatsSets;

PD.ElmMats = ones(122,1)*13;

PD.BCType = [0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             1, 1, 1;
             1, 1, 1;
             1, 1, 1;
             1, 1, 1;
             1, 1, 1;
             1, 1, 1;
                   ];

PD.BCVal = [3e+5, 0.156e+5, 0;
           -3e+5, -0.156e+5, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
             0, 0, 0;
                   ];

PDans = PD_truss_static(PD)
Nodal_displacments = PDans.U
Truss_Member_stresses = PDans.ElmStress
PlotTruss(PDans, 1, 'y', 'y')
%view([-212,30])

truss_mass = 0;
for i=1:PD.NE
  bconn = PD.ElmConnect(i,:);
  blen = norm(PD.NodePos(bconn(2),:) - PD.NodePos(bconn(1),:));
  bmat = PD.MatsSets(PD.ElmMats(i));

  bar_mass = blen * bmat.A * bmat.rho;

  truss_mass = truss_mass + bar_mass;
end


truss_mass


save('truss_davie378.mat','PD')
evaluate_truss_design_template('davie378')